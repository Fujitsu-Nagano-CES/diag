MODULE diag_functions
!-------------------------------------------------------------------------------
!
!     Module for geometry
!                                                   (S. Maeyama, 8 July 2014)
!
!-------------------------------------------------------------------------------
  implicit none

  public


 CONTAINS

FUNCTION besselj0(x)
!--------------------------------------
!  Bessel J_0(x) function in double precision
  use diag_header, only : DP
  implicit none

  real(kind=DP) :: besselj0
  real(kind=DP), intent(in) :: x

  integer :: k
  real(kind=DP) :: t, v, w, y, theta
  real(kind=DP), parameter :: pi4 = 0.78539816339744830962d0
  real(kind=DP) :: a(0:7) = (/                               &
         -0.0000000000023655394d0, 0.0000000004708898680d0,  &
         -0.0000000678167892231d0, 0.0000067816840038636d0,  &
         -0.0004340277777716935d0, 0.0156249999999992397d0,  &
         -0.2499999999999999638d0, 0.9999999999999999997d0 /)
  real(kind=DP) :: b(0:64) = (/                              &
         0.0000000000626681117d0, -0.0000000022270614428d0,  &
         0.0000000662981656302d0, -0.0000016268486502196d0,  &
         0.0000321978384111685d0, -0.0005005237733315830d0,  &
         0.0059060313537449816d0, -0.0505265323740109701d0,  &
         0.2936432097610503985d0, -1.0482565081091638637d0,  &
         1.9181123286040428113d0, -1.1319199475221700100d0,  &
         -0.1965480952704682000d0,                           &
         0.0000000000457457332d0, -0.0000000015814772025d0,  &
         0.0000000455487446311d0, -0.0000010735201286233d0,  &
         0.0000202015179970014d0, -0.0002942392368203808d0,  &
         0.0031801987726150648d0, -0.0239875209742846362d0,  &
         0.1141447698973777641d0, -0.2766726722823530233d0,  &
         0.1088620480970941648d0, 0.5136514645381999197d0,   &
         -0.2100594022073706033d0,                           &
         0.0000000000331366618d0, -0.0000000011119090229d0,  &
         0.0000000308823040363d0, -0.0000006956602653104d0,  &
         0.0000123499947481762d0, -0.0001662951945396180d0,  &
         0.0016048663165678412d0, -0.0100785479932760966d0,  &
         0.0328996815223415274d0, -0.0056168761733860688d0,  &
         -0.2341096400274429386d0, 0.2551729256776404262d0,  &
         0.2288438186148935667d0,                            &
         0.0000000000238007203d0, -0.0000000007731046439d0,  &
         0.0000000206237001152d0, -0.0000004412291442285d0,  &
         0.0000073107766249655d0, -0.0000891749801028666d0,  &
         0.0007341654513841350d0, -0.0033303085445352071d0,  &
         0.0015425853045205717d0, 0.0521100583113136379d0,   &
         -0.1334447768979217815d0, -0.1401330292364750968d0, &
         0.2685616168804818919d0,                            &
         0.0000000000169355950d0, -0.0000000005308092192d0,  &
         0.0000000135323005576d0, -0.0000002726650587978d0,  &
         0.0000041513240141760d0, -0.0000443353052220157d0,  &
         0.0002815740758993879d0, -0.0004393235121629007d0,  &
         -0.0067573531105799347d0, 0.0369141914660130814d0,  &
         0.0081673361942996237d0, -0.2573381285898881860d0,  &
         0.0459580257102978932d0 /)
  real(kind=DP) :: c(0:69) = (/                                & 
         -0.00000000003009451757d0, -0.00000000014958003844d0, &
         0.00000000506854544776d0, 0.00000001863564222012d0,   &
         -0.00000060304249068078d0, -0.00000147686259937403d0, &
         0.00004714331342682714d0, 0.00006286305481740818d0,   &
         -0.00214137170594124344d0, -0.00089157336676889788d0, &
         0.04508258728666024989d0, -0.00490362805828762224d0,  &
         -0.27312196367405374426d0, 0.04193925184293450356d0,  &
         -0.00000000000712453560d0, -0.00000000041170814825d0, &
         0.00000000138012624364d0, 0.00000005704447670683d0,   &
         -0.00000019026363528842d0, -0.00000533925032409729d0, &
         0.00001736064885538091d0, 0.00030692619152608375d0,   &
         -0.00092598938200644367d0, -0.00917934265960017663d0, &
         0.02287952522866389076d0, 0.10545197546252853195d0,   &
         -0.16126443075752985095d0, -0.19392874768742235538d0, &
         0.00000000002128344556d0, -0.00000000031053910272d0,  &
         -0.00000000334979293158d0, 0.00000004507232895050d0,  &
         0.00000036437959146427d0, -0.00000446421436266678d0,  &
         -0.00002523429344576552d0, 0.00027519882931758163d0,  &
         0.00097185076358599358d0, -0.00898326746345390692d0,  &
         -0.01665959196063987584d0, 0.11456933464891967814d0,  &
         0.07885001422733148815d0, -0.23664819446234712621d0,  &
         0.00000000003035295055d0, 0.00000000005486066835d0,   &
         -0.00000000501026824811d0, -0.00000000501246847860d0, &
         0.00000058012340163034d0, 0.00000016788922416169d0,   &
         -0.00004373270270147275d0, 0.00001183898532719802d0,  &
         0.00189863342862291449d0, -0.00113759249561636130d0,  &
         -0.03846797195329871681d0, 0.02389746880951420335d0,  &
         0.22837862066532347461d0, -0.06765394811166522844d0,  &
         0.00000000001279875977d0, 0.00000000035925958103d0,   &
         -0.00000000228037105967d0, -0.00000004852770517176d0, &
         0.00000028696428000189d0, 0.00000440131125178642d0,   &
         -0.00002366617753349105d0, -0.00024412456252884129d0, &
         0.00113028178539430542d0, 0.00708470513919789080d0,   &
         -0.02526914792327618386d0, -0.08006137953480093426d0, &
         0.16548380461475971846d0, 0.14688405470042110229d0 /)
  real(kind=DP) :: d(0:51) = (/                               &
         1.059601355592185731d-14, -2.71150591218550377d-13,  &
         8.6514809056201638d-12, -4.6264028554286627d-10,     &
         5.0815403835647104d-8, -1.76722552048141208d-5,      &
         0.16286750396763997378d0, 2.949651820598278873d-13,  &
         -8.818215611676125741d-12, 3.571119876162253451d-10, &
         -2.631924120993717060d-8, 4.709502795656698909d-6,   &
         -5.208333333333283282d-3,                            &
         7.18344107717531977d-15, -2.51623725588410308d-13,   &
         8.6017784918920604d-12, -4.6256876614290359d-10,     &
         5.0815343220437937d-8, -1.76722551764941970d-5,      &
         0.16286750396763433767d0, 2.2327570859680094777d-13, &
         -8.464594853517051292d-12, 3.563766464349055183d-10, &
         -2.631843986737892965d-8, 4.709502342288659410d-6,   &
         -5.2083333332278466225d-3,                           &
         5.15413392842889366d-15, -2.27740238380640162d-13,   &
         8.4827767197609014d-12, -4.6224753682737618d-10,     &
         5.0814848128929134d-8, -1.76722547638767480d-5,      &
         0.16286750396748926663d0, 1.7316195320192170887d-13, &
         -7.971122772293919646d-12, 3.544039469911895749d-10, &
         -2.631443902081701081d-8, 4.709498228695400603d-6,   &
         -5.2083333315143653610d-3,                           &
         3.84653681453798517d-15, -2.04464520778789011d-13,   &
         8.3089298605177838d-12, -4.6155016158412096d-10,     &
         5.0813263696466650d-8, -1.76722528311426167d-5,      &
         0.16286750396650065930d0, 1.3797879972460878797d-13, &
         -7.448089381011684812d-12, 3.512733797106959780d-10, &
         -2.630500895563592722d-8, 4.709483934775839193d-6,   &
         -5.2083333227940760113d-3 /)
      w = abs(x)
      if (w .lt. 1) then
          t = w * w
          y = ((((((a(0) * t + a(1)) * t +        &
             a(2)) * t + a(3)) * t + a(4)) * t +  &
             a(5)) * t + a(6)) * t + a(7)
      else if (w .lt. 8.5d0) then
          t = w * w * 0.0625d0
          k = int(t)
          t = t - (real(k, kind=DP) + 0.5d0) !!! t = t - (k + 0.5d0)
          k = k * 13
          y = (((((((((((b(k) * t + b(k + 1)) * t +           &
             b(k + 2)) * t + b(k + 3)) * t + b(k + 4)) * t +  &
             b(k + 5)) * t + b(k + 6)) * t + b(k + 7)) * t +  &
             b(k + 8)) * t + b(k + 9)) * t + b(k + 10)) * t + &
             b(k + 11)) * t + b(k + 12)
      else if (w .lt. 12.5d0) then
          k = int(w)
          t = w - (real(k, kind=DP) + 0.5d0) !!! t = w - (k + 0.5d0)
          k = 14 * (k - 8)
          y = ((((((((((((c(k) * t + c(k + 1)) * t +          &
             c(k + 2)) * t + c(k + 3)) * t + c(k + 4)) * t +  &
             c(k + 5)) * t + c(k + 6)) * t + c(k + 7)) * t +  &
             c(k + 8)) * t + c(k + 9)) * t + c(k + 10)) * t + &
             c(k + 11)) * t + c(k + 12)) * t + c(k + 13)
      else
          v = 24.d0 / w                      !!! v = 24 / w
          t = v * v
          k = 13 * (int(t))
          y = ((((((d(k) * t + d(k + 1)) * t +               &
             d(k + 2)) * t + d(k + 3)) * t + d(k + 4)) * t + &
             d(k + 5)) * t + d(k + 6)) * sqrt(v)
          theta = (((((d(k + 7) * t + d(k + 8)) * t +          &
             d(k + 9)) * t + d(k + 10)) * t + d(k + 11)) * t + &
             d(k + 12)) * v - pi4
          y = y * cos(w + theta)
      end if
      besselj0 = y

END FUNCTION besselj0


FUNCTION besseli0(x)
!--------------------------------------
!  Bessel I_0(x) function in double precision
  use diag_header, only : DP
  implicit none

  real(kind=DP) :: besseli0
  real(kind=DP), intent(in) :: x

  integer :: k
  real(kind=DP) :: t, w, y
  real(kind=DP) :: a(0:64) = (/                                &
         8.5246820682016865877d-11, 2.5966600546497407288d-9,  &
         7.9689994568640180274d-8, 1.9906710409667748239d-6,   &
         4.0312469446528002532d-5, 6.4499871606224265421d-4,   &
         7.9012345761930579108d-3, 7.1111111109207045212d-2,   &
         4.4444444444472490900d-1, 1.7777777777777532045d0,    &
         4.0000000000000011182d0, 3.9999999999999999800d0,     &
         1.0000000000000000001d0,                              &
         1.1520919130377195927d-10, 2.2287613013610985225d-9,  &
         8.1903951930694585113d-8, 1.9821560631611544984d-6,   &
         4.0335461940910133184d-5, 6.4495330974432203401d-4,   &
         7.9013012611467520626d-3, 7.1111038160875566622d-2,   &
         4.4444450319062699316d-1, 1.7777777439146450067d0,    &
         4.0000000132337935071d0, 3.9999999968569015366d0,     &
         1.0000000003426703174d0,                              &
         1.5476870780515238488d-10, 1.2685004214732975355d-9,  &
         9.2776861851114223267d-8, 1.9063070109379044378d-6,   &
         4.0698004389917945832d-5, 6.4370447244298070713d-4,   &
         7.9044749458444976958d-3, 7.1105052411749363882d-2,   &
         4.4445280640924755082d-1, 1.7777694934432109713d0,    &
         4.0000055808824003386d0, 3.9999977081165740932d0,     &
         1.0000004333949319118d0,                              &
         2.0675200625006793075d-10, -6.1689554705125681442d-10,& 
         1.2436765915401571654d-7, 1.5830429403520613423d-6,   &
         4.2947227560776583326d-5, 6.3249861665073441312d-4,   &
         7.9454472840953930811d-3, 7.0994327785661860575d-2,   &
         4.4467219586283000332d-1, 1.7774588182255374745d0,    &
         4.0003038986252717972d0, 3.9998233869142057195d0,     &
         1.0000472932961288324d0,                              &
         2.7475684794982708655d-10, -3.8991472076521332023d-9, &
         1.9730170483976049388d-7, 5.9651531561967674521d-7,   &
         5.1992971474748995357d-5, 5.7327338675433770752d-4,   &
         8.2293143836530412024d-3, 6.9990934858728039037d-2,   &
         4.4726764292723985087d-1, 1.7726685170014087784d0,    &
         4.0062907863712704432d0, 3.9952750700487845355d0,     &
         1.0016354346654179322d0 /)
  real(kind=DP) :: b(0:69) = (/                              &
         6.7852367144945531383d-8, 4.6266061382821826854d-7, &
         6.9703135812354071774d-6, 7.6637663462953234134d-5, &
         7.9113515222612691636d-4, 7.3401204731103808981d-3, &
         6.0677114958668837046d-2, 4.3994941411651569622d-1, &
         2.7420017097661750609d0, 14.289661921740860534d0,   &
         59.820609640320710779d0, 188.78998681199150629d0,   &
         399.87313678256011180d0, 427.56411572180478514d0,   &
         1.8042097874891098754d-7, 1.2277164312044637357d-6, &
         1.8484393221474274861d-5, 2.0293995900091309208d-4, &
         2.0918539850246207459d-3, 1.9375315654033949297d-2, &
         1.5985869016767185908d-1, 1.1565260527420641724d0,  &
         7.1896341224206072113d0, 37.354773811947484532d0,   &
         155.80993164266268457d0, 489.52113711585409180d0,   &
         1030.9147225169564806d0, 1093.5883545113746958d0,   &
         4.8017305613187493564d-7, 3.2613178439123800740d-6, &
         4.9073137508166159639d-5, 5.3806506676487583755d-4, &
         5.5387918291051866561d-3, 5.1223717488786549025d-2, &
         4.2190298621367914765d-1, 3.0463625987357355872d0,  &
         18.895299447327733204d0, 97.915189029455461554d0,   &
         407.13940115493494659d0, 1274.3088990480582632d0,   &
         2670.9883037012547506d0, 2815.7166284662544712d0,   &
         1.2789926338424623394d-6, 8.6718263067604918916d-6, &
         1.3041508821299929489d-4, 1.4282247373727478920d-3, &
         1.4684070635768789378d-2, 1.3561403190404185755d-1, &
         1.1152592585977393953d0, 8.0387088559465389038d0,   &
         49.761318895895479206d0, 257.26842323135291380d0,   &
         1066.8543146269566231d0, 3328.3874581009636362d0,   &
         6948.8586598121634874d0, 7288.4893398212481055d0,   &
         3.4093503681970328930d-6, 2.3079025203103376076d-5, &
         3.4691373283901830239d-4, 3.7949949772229085450d-3, &
         3.8974209677945602145d-2, 3.5949483804148783710d-1, &
         2.9522878893539528226d0, 21.246564609514287056d0,   &
         131.28727387146173141d0, 677.38107093296675421d0,   &
         2802.3724744545046518d0, 8718.5731420798254081d0,   &
         18141.348781638832286d0, 18948.925349296308859d0 /)
  real(kind=DP) :: c(0:44) = (/                                &
         2.5568678676452702768d-15, 3.0393953792305924324d-14, &
         6.3343751991094840009d-13, 1.5041298011833009649d-11, &
         4.4569436918556541414d-10, 1.7463930514271679510d-8,  &
         1.0059224011079852317d-6, 1.0729838945088577089d-4,   &
         5.1503226936425277380d-2,                             &
         5.2527963991711562216d-15, 7.2021184814210056410d-15, &
         7.2561421229904797156d-13, 1.4823121466731042510d-11, &
         4.4602670450376245434d-10, 1.7463600061788679671d-8,  &
         1.0059226091322347560d-6, 1.0729838937545111487d-4,   &
         5.1503226936437300716d-2,                             &
         1.3365917359358069908d-14, -1.2932643065888544835d-13,& 
         1.7450199447905602915d-12, 1.0419051209056979788d-11, &
         4.5804788198059832600d-10, 1.7442405450073548966d-8,  &
         1.0059461453281292278d-6, 1.0729837434500161228d-4,   &
         5.1503226940658446941d-2,                             &
         5.3771611477352308649d-14, -1.1396193006413731702d-12,& 
         1.2858641335221653409d-11, -5.9802086004570057703d-11,& 
         7.3666894305929510222d-10, 1.6731837150730356448d-8,  &
         1.0070831435812128922d-6, 1.0729733111203704813d-4,   &
         5.1503227360726294675d-2,                             &
         3.7819492084858931093d-14, -4.8600496888588034879d-13,& 
         1.6898350504817224909d-12, 4.5884624327524255865d-11, &
         1.2521615963377513729d-10, 1.8959658437754727957d-8,  &
         1.0020716710561353622d-6, 1.0730371198569275590d-4,   &
         5.1503223833002307750d-2 /)
      w = abs(x)
      if (w .lt. 8.5d0) then
          t = w * w * 0.0625d0
          k = 13 * (int(t))
          y = (((((((((((a(k) * t + a(k + 1)) * t +           &
             a(k + 2)) * t + a(k + 3)) * t + a(k + 4)) * t +  &
             a(k + 5)) * t + a(k + 6)) * t + a(k + 7)) * t +  &
             a(k + 8)) * t + a(k + 9)) * t + a(k + 10)) * t + &
             a(k + 11)) * t + a(k + 12)
      else if (w .lt. 12.5d0) then
          k = int(w)
          t = w - real(k, kind=DP)        !!! t = w - k
          k = 14 * (k - 8)
          y = ((((((((((((b(k) * t + b(k + 1)) * t +          &
             b(k + 2)) * t + b(k + 3)) * t + b(k + 4)) * t +  &
             b(k + 5)) * t + b(k + 6)) * t + b(k + 7)) * t +  &
             b(k + 8)) * t + b(k + 9)) * t + b(k + 10)) * t + &
             b(k + 11)) * t + b(k + 12)) * t + b(k + 13)
      else
          t = 60.d0 / w                   !!! t = 60 / w
          k = 9 * (int(t))
          y = ((((((((c(k) * t + c(k + 1)) * t +             &
             c(k + 2)) * t + c(k + 3)) * t + c(k + 4)) * t + &
             c(k + 5)) * t + c(k + 6)) * t + c(k + 7)) * t + &
             c(k + 8)) * sqrt(t) * exp(w)
      end if
      besseli0 = y

END FUNCTION besseli0


FUNCTION besseli1(x)
!--------------------------------------
!  Bessel I_1(x) function in double precision
  use diag_header, only : DP
  implicit none

  real(kind=DP) :: besseli1
  real(kind=DP), intent(in) :: x

  integer :: k
  real(kind=DP) :: t, w, y
  real(kind=DP) :: a(0:59) = (/                                &
         1.2787464404046789181d-10, 3.5705860060088241077d-9,  &
         9.9611537619347335040d-8, 2.2395070088633043177d-6,   &
         4.0312466928887462346d-5, 5.6437387840203722356d-4,   &
         5.9259259312934746096d-3, 4.4444444443499008870d-2,   &
         2.2222222222232042719d-1, 6.6666666666666139867d-1,   &
         1.0000000000000001106d0, 4.9999999999999999962d-1,    &
         1.7281952384448634449d-10, 3.0647204559976390130d-9,  &
         1.0237662138842827028d-7, 2.2299494417341498163d-6,   &
         4.0335364374929326943d-5, 5.6433440269141349899d-4,   &
         5.9259754885893798654d-3, 4.4444399410880397870d-2,   &
         2.2222225112835026730d-1, 6.6666665422146063244d-1,   &
         1.0000000032274936821d0, 4.9999999961866867205d-1,    &
         2.3216048939948030996d-10, 1.7443372702334489579d-9,  &
         1.1596478963485415499d-7, 2.1446755518623035147d-6,   &
         4.0697440347437076195d-5, 5.6324394900433192204d-4,   &
         5.9283484996093060678d-3, 4.4440673899150997921d-2,   &
         2.2222638016852657860d-1, 6.6666358151576732094d-1,   &
         1.0000013834029985337d0, 4.9999971643129650249d-1,    &
         3.1013758938255172562d-10, -8.4813676145611694984d-10,&
         1.5544980187411802596d-7, 1.7811109378708045726d-6,   &
         4.2945322199060856985d-5, 5.5344850176852353639d-4,   &
         5.9590327716950614802d-3, 4.4371611097707060659d-2,   &
         2.2233578241986401111d-1, 6.6654747300463315310d-1,   &
         1.0000756505206705927d0, 4.9997803664415994554d-1,    &
         4.1214758313965020365d-10, -5.3613317735347429440d-9, &
         2.4661360807517345161d-7, 6.7144593918926723203d-7,   &
         5.1988027944945587571d-5, 5.0165568586065803067d-4,   &
         6.1717530047005289953d-3, 4.3745229577317251404d-2,   &
         2.2363147971477747996d-1, 6.6475469131117660240d-1,   &
         1.0015686689447547657d0, 4.9941120439785391891d-1 /)
  real(kind=DP) :: b(0:69) = (/                             &
         6.6324787943143095845d-8, 4.5125928898466638619d-7,&
         6.7937793134877246623d-6, 7.4580507871505926302d-5,&
         7.6866382927334005919d-4, 7.1185174803491859307d-3,&
         5.8721838073486424416d-2, 4.2473949281714196041d-1,&
         2.6396965606282079123d0, 13.710008536637016903d0,  &
         57.158647688180932003d0, 179.46182892089389037d0,  &
         377.57997362398478619d0, 399.87313678256009819d0,  &
         1.7652713206027939711d-7, 1.1988179244834708057d-6,&
         1.8037851545747139231d-5, 1.9775785516370314656d-4,&
         2.0354870702829387283d-3, 1.8822164191032253600d-2,&
         1.5500485219010424263d-1, 1.1190100010560573210d0, &
         6.9391565185406617552d0, 35.948170579648649345d0,  &
         149.41909525103032616d0, 467.42979492780642582d0,  &
         979.04227423171290408d0, 1030.9147225169564443d0,  &
         4.7022299276154507603d-7, 3.1878571710170115972d-6,&
         4.7940153875711448496d-5, 5.2496623508411440227d-4,&
         5.3968661134780824779d-3, 4.9837081920693776234d-2,&
         4.0979593830387765545d-1, 2.9533186922862948404d0, &
         18.278176130722516369d0, 94.476497150189121070d0,  &
         391.66075612645333624d0, 1221.4182034643210345d0,  &
         2548.6177980961291004d0, 2670.9883037012546541d0,  &
         1.2535083724002034147d-6, 8.4845871420655708250d-6,&
         1.2753227372734042108d-4, 1.3950105363562648921d-3,&
         1.4325473993765291906d-2, 1.3212452778932829125d-1,&
         1.0849287786885151432d0, 7.8068089156260172673d0,  &
         48.232254570679165833d0, 248.80659424902394371d0,  &
         1029.0736929484210803d0, 3200.5629438795801652d0,  &
         6656.7749162019607914d0, 6948.8586598121632302d0,  &
         3.3439394490599745013d-6, 2.2600596902211837757d-5,&
         3.3955927589987356838d-4, 3.7105306061050972474d-3,&
         3.8065263634919156421d-2, 3.5068223415665236079d-1,&
         2.8760027832105027316d0, 20.665999500843274339d0,  &
         127.47939148516390205d0, 656.43636874254000885d0,  &
         2709.5242837932479920d0, 8407.1174233600734871d0,  &
         17437.146284159740233d0, 18141.348781638831600d0 /)
  real(kind=DP) :: c(0:44) = (/                                 &
         -2.8849790431465382128d-15, -3.5125350943844774657d-14,&
         -7.4850867013707419750d-13, -1.8383904048277485153d-11,&
         -5.7303556446977223342d-10, -2.4449502737311496525d-8, &
         -1.6765373351766929724d-6, -3.2189516835265773471d-4,  &
         5.1503226936425277377d-2,                              &
         -5.8674306822281631119d-15, -9.4884898451194085565d-15,&
         -8.5033865136600364340d-13, -1.8142997866945285736d-11,&
         -5.7340238386338193949d-10, -2.4449138101742183665d-8, &
         -1.6765375646678855842d-6, -3.2189516826945356325d-4,  &
         5.1503226936412017608d-2 ,                             &
         -1.4723362506764340882d-14, 1.3945147385179042899d-13, &
         -1.9618041857586930923d-12, -1.3343606394065121821d-11,&
         -5.8649674606973244159d-10, -2.4426060539669553778d-8, &
         -1.6765631828366988006d-6, -3.2189515191449587253d-4,  &
         5.1503226931820146445d-2 ,                             &
         -5.8203519372580372987d-14, 1.2266326995309845825d-12, &
         -1.3921625844526453237d-11, 6.2228025878281625469d-11, &
         -8.8636681342142794023d-10, -2.3661241616744818608d-8, &
         -1.6777870960740520557d-6, -3.2189402882677074318d-4,  &
         5.1503226479551959376d-2 ,                             &
         -4.5801527369223291722d-14, 6.7998819697143727209d-13, &
         -4.1624857909290468421d-12, -3.2849009406112440998d-11,&
         -3.2478275690431118270d-10, -2.5739209934053714983d-8, &
         -1.6730566573215739195d-6, -3.2190010909008684076d-4,  &
         5.1503229866932077150d-2 /)
      w = abs(x)
      if (w .lt. 8.5d0) then
          t = w * w * 0.0625d0
          k = 12 * (int(t))
          y = (((((((((((a(k) * t + a(k + 1)) * t +           &
             a(k + 2)) * t + a(k + 3)) * t + a(k + 4)) * t +  &
             a(k + 5)) * t + a(k + 6)) * t + a(k + 7)) * t +  &
             a(k + 8)) * t + a(k + 9)) * t + a(k + 10)) * t + &
             a(k + 11)) * w
      else if (w .lt. 12.5d0) then
          k = int(w)
          t = w - k
          k = 14 * (k - 8)
          y = ((((((((((((b(k) * t + b(k + 1)) * t +          &
             b(k + 2)) * t + b(k + 3)) * t + b(k + 4)) * t +  &
             b(k + 5)) * t + b(k + 6)) * t + b(k + 7)) * t +  &
             b(k + 8)) * t + b(k + 9)) * t + b(k + 10)) * t + &
             b(k + 11)) * t + b(k + 12)) * t + b(k + 13)
      else
          t = 60 / w
          k = 9 * (int(t))
          y = ((((((((c(k) * t + c(k + 1)) * t +             &
             c(k + 2)) * t + c(k + 3)) * t + c(k + 4)) * t + &
             c(k + 5)) * t + c(k + 6)) * t + c(k + 7)) * t + &
             c(k + 8)) * sqrt(t) * exp(w)
      end if
      if (x .lt. 0) y = -y
      besseli1 = y

END FUNCTION besseli1

END MODULE diag_functions



